# Wall of Photos

Кирпичная стена из слотов для фотографий: каждый кирпич — один слот. Загружаете фото — оно появляется в случайном свободном кирпиче.

## Стек

- **Next.js 14+** (App Router)
- **TypeScript**
- **Tailwind CSS**
- **Vercel Blob Storage** (фото и JSON со слотами)

## Быстрый старт

```bash
npm install
npm run dev
```

Откройте [http://localhost:3000](http://localhost:3000). Без переменных окружения стена покажет 100 пустых слотов; загрузка фото будет выдавать ошибку до настройки Blob.

---

## Подключение Vercel Blob

1. Зайдите в [Vercel Dashboard](https://vercel.com/dashboard) → ваш проект (или создайте).
2. **Storage** → **Create Database** → выберите **Blob**.
3. Создайте store (например, `wall-photos`).
4. В настройках store откройте **.env** и скопируйте переменную:
   - `BLOB_READ_WRITE_TOKEN`

### Локальная разработка

Создайте файл `.env.local` в корне проекта:

```env
BLOB_READ_WRITE_TOKEN=vercel_blob_rw_xxxxxxxxxxxx
```

Подставьте свой токен из шага выше. Перезапустите `npm run dev`.

---

## Переменные окружения

| Переменная | Обязательная | Описание |
|------------|--------------|----------|
| `BLOB_READ_WRITE_TOKEN` | Да (для загрузки) | Токен Vercel Blob. Без него загрузка фото и сохранение слотов недоступны. |

Без токена приложение работает в режиме «только просмотр»: отображаются 100 пустых слотов, кнопка «Добавить фото» при нажатии вернёт ошибку.

---

## Деплой на Vercel

1. Залейте проект в Git (GitHub / GitLab / Bitbucket).
2. [vercel.com](https://vercel.com) → **Add New** → **Project** → импортируйте репозиторий.
3. В настройках проекта откройте **Environment Variables** и добавьте:
   - `BLOB_READ_WRITE_TOKEN` — токен из Vercel Blob (см. выше).
4. Привяжите Blob Store к проекту:
   - **Storage** → ваш Blob store → **Connect to Project** → выберите этот проект.
5. Нажмите **Deploy**.

После деплоя загрузка фото и сохранение слотов будут работать в production.

---

## Структура проекта

```
├── app/
│   ├── api/
│   │   ├── slots/route.ts   # GET — список всех слотов
│   │   └── upload/route.ts  # POST — загрузка файла, выбор слота, сохранение
│   ├── globals.css
│   ├── layout.tsx
│   └── page.tsx
├── components/
│   ├── Brick.tsx            # Один кирпич (пустой “+” или фото)
│   └── WallGrid.tsx         # Сетка кирпичей и загрузка
├── lib/
│   ├── db.ts                # Чтение/запись слотов (Blob JSON)
│   ├── storage.ts           # Загрузка изображений в Blob, валидация
│   └── types.ts             # Типы и константы (TOTAL_SLOTS = 100)
└── README.md
```

## Ограничения

- **Размер файла:** до 5 МБ.
- **Типы:** JPEG, PNG, GIF, WebP.
- **Слотов на стене:** 100 (меняется в `lib/types.ts` → `TOTAL_SLOTS`).

## Логика загрузки

1. Пользователь выбирает файл → проверка типа и размера.
2. Запрос к `GET /api/slots` (если ещё не загружены) и выбор случайного свободного слота.
3. Файл загружается в Vercel Blob, в Blob же обновляется JSON с данными слотов.
4. В ответе возвращаются `slotId`, `imageUrl`, `createdAt` — интерфейс обновляется без перезагрузки.

Если свободных слотов нет, API вернёт ошибку «Нет свободных слотов на стене».
